## IDO 奖励分配与 WEDO 转换（产品设计）

### 背景与目标

- **目标**: 本文档描述了 `IDO` 代币的奖励分配机制以及 `WEDO` 代币向 `IDO` 代币的转换流程。旨在强化 `IDO` 的用例激励，并提供团队经济体系的灵活性。
- **与现有机制衔接**: `IDO/WEDO` 的日常记账与分红；淘汰规则仍由打卡与团队机制决定（见 `docs/spec.md`）。

### 核心概念

- **WEDO 转换**: 团队金库中的 `WEDO` 代币可以按照一定比例转换为 `IDO` 代币。
- **IDO 奖励分配**: 用户可以根据其在团队中的贡献（通过 `WEDO` 转换获得 `IDO`）来领取奖励。
- **结算快照（Snapshot）**: (未来计划) 在活动“结束时刻”对 `IDO` 的符合资格持仓进行快照，作为分配基准。
- **资格（Eligibility）**: (未来计划) 是否纳入结算的 `IDO` 与地址范围。

### 资金流与公式

1. WEDO 转换 IDO

- 活跃成员可以将团队金库中的 `WEDO` 转换为 `IDO`。
- 转换公式：`mintIdo = amountWEDO * L / 1e3`，其中 `L` 是杠杆值（已包含 `S` 阶段标量）。
- 转换后，`WEDO` 从团队金库中销毁，相应数量的 `IDO` 会被铸造。

2. IDO 奖励领取

- 团队成员可以领取其应得的 `IDO` 代币。
- 可领取 `IDO` 数量 `pendingIdo` 由以下公式计算：`accrued + (current - debt)`，其中 `current = shares * accIdoPerSurvivor`。

3. 页面预估 (未来计划，当前未实现)

- (未来计划) 预估奖励（非承诺值）：\( est_reward_i = T\_{now} \times \frac{bal_IDO_i}{S\_{now}} \)，其中 `S_now` 为当前（非快照）符合资格的 `IDO` 总量。
- (未来计划) 明确提示：“最终以结算快照为准，期间 IDO/奖池变化会影响预估值”。

### 资格与快照

- **当前选择**: 活跃成员可以进行 `WEDO` 转换和 `IDO` 领取。

- **未来计划 (幸存者模式)**:

  - (未来计划) 结算时刻拥有 `IDO` 的任意地址（无论是否被淘汰）均纳入快照 `S`。
  - (未来计划) 符合现有公平性：被淘汰者既无法继续从团队 `WEDO→IDO` 分红中获益，但其已持有的 `IDO` 仍具有期末权益。

- **可选模式（仅幸存者）**:

  - (未来计划) 仅团队“未淘汰成员”的地址进入快照 `S`（由平台配置 `eligibilityAtSettlement = survivorsOnly`）。
  - (未来计划) 页面需明显标注“仅限未淘汰成员分配”。

- **技术要点（不写实现，仅约束）**:
  - 快照基于区块高度或时间戳锁定；
  - 快照后至用户领取前的 `IDO` 流转不影响 `claimableIDO`。

### 退出与异常处理

- **主动退赛/被淘汰**:

  - (未来计划) 当前代码库中没有与 ETH 质押相关的退出和异常处理逻辑。
  - 用户被淘汰后，无法继续从团队 `WEDO` 转换中获得 `IDO`，但其已有的 `IDO` 持仓不受影响。

- **技术失败/回滚**: 若结算执行失败，保留重试与紧急暂停（`paused`）开关；在暂停期间不可新质押与领取。

### 页面与交互 (未来计划，当前未实现 ETH 质押相关页面)

页面：`IDO 奖池`

- **顶部导航**: 左侧“残酷小队”返回入口；右侧“连接钱包”按钮。
- **主视觉区**:

  - (未来计划) 大字显示“当前奖池：{T} ETH”。
  - (未来计划) 说明文案（可编辑）：
    - (未来计划) 奖池来源：成员质押与赞助累计。
    - (未来计划) 参与需质押：默认 0.3 ETH；退出/被淘汰的处理规则。
    - (未来计划) 结算时间：例如 `2025/09/01`。
    - (未来计划) 规则：按结算快照的 `IDO` 权重分配。

- **概览区（两列）**:

  - (未来计划) 左列“总览表”：`地址 | IDO | 预估奖励`（分页，地址做中间打码）。
  - 右列“我的面板”：
    - 我的 `IDO`：`b_me`；
    - 我的可领取 `IDO`：`pendingIdo_me`；
    - CTA：
      - “领取 IDO”按钮（仅当 `pendingIdo_me > 0`）。
      - (未来计划) 结算后显示“领取 ETH”按钮（仅当 `claimableETH_me > 0`）。
    - 提示：结算后在此处出现领取按钮。

- **状态与提示**:
  - 活动进行中：展示预估值与风险提示。
  - 已结算未领取：展示“你可领取 X.XXX IDO”。
  - 已领取：展示“已领取，交易哈希”。

### 用户旅程

1. 参与日常活动

- 与现有系统一致：完成任务获得 `IDO`，团队 `WEDO` 记账与分红不变。

2. WEDO 转换为 IDO

- 连接钱包 → 进入团队页面 → 点击“转换 WEDO 为 IDO” → 输入转换数量 → 成功后更新个人 `IDO` 余额和团队 `WEDO` 余额。

3. 领取 IDO

- 连接钱包 → 进入团队页面 → 点击“领取 IDO” → 成功后更新个人 `IDO` 余额。

### 配置项（平台级）

- `minDepositETH`（未来计划，当前未实现）
- `eligibilityAtSettlement`：`allHolders`｜`survivorsOnly` (未来计划，当前未实现)
- `refundRateOnQuit`：退赛退还比例（0–100%） (未来计划，当前未实现)
- `allowExtraSponsors`：是否允许附加赞助资金注入奖池 (未来计划，当前未实现)
- `endTimestamp`：结算时间 (未来计划，当前未实现)

### 文案范例

- 规则说明（可在页面展示）:
  - “通过团队贡献获得 WEDO，可将 WEDO 转换为 IDO。根据你持有的 IDO 比例领取奖励。未来可能会引入 ETH 质押和奖池分配功能。”

### 示例 (当前仅支持 IDO 奖励，无 ETH 奖池)

- 当前团队总 `WEDO`：`1000 WEDO`
- 你的 `IDO` 可领取量：`10 IDO`

### 指标与风控

- 指标：
  - `WEDO` 转换 `IDO` 数量、`IDO` 领取完成率、平均领取时延。
  - 贡献影响：人均 `IDO` 与人均奖励的相关性。
- 风控：
  - 反女巫：账号活跃阈值；
  - 反钓鱼：提现白名单/延时领取（可选）；
  - 合规提醒：非证券承诺，纯活动激励。

### 数据与事件（只做约束，不写实现）

- 数据面（链上）：
  - 团队 `WEDO` 余额 `T`、`IDO` 可领取量 `pendingIdo`。
- 事件面：
  - `TeamWithdraw(teamId, caller, amountWEDO, L, mintIdo, R)` (WEDO 转换 IDO)
  - `Claimed(teamId, account, amount)` (IDO 领取)

### 与团队榜单的关系

- `IDO` 奖励分配与“团队内 `WEDO→IDO` 均分”互不冲突：
  - 日常：团队活跃提高 `IDO` 获得速度；
  - 期末：更高 `IDO` 持仓获得更大 `IDO` 份额；
  - 排行展示：保留“人均分红”“当前 L 与团队总分”等指标，新增“期末 `IDO` 奖励预估/实际”。

### 上线节奏（MVP）

1. MVP：`WEDO` 转换 `IDO` + `IDO` 领取模型。
2. v2：支持 ETH 质押，并增加相关配置。
3. v3：多阶段奖池（周/月结）、多次快照合并、二级市场/回购玩法。
